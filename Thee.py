# coding:utf-8

import requests
import time
from multiprocessing import Pool


def get_ip_pools(ip_strs):
    ip_pool=[]
    # ip_strs = """
    # 121.31.100.11:8123
    # 122.114.31.177:808
    # 219.138.58.30:3128
    # 61.135.217.7:80
    # 183.52.150.215:61234
    # 123.128.197.192:8118
    # 110.72.255.170:8123
    # 183.52.150.152:61234
    # 110.73.43.240:8123
    # 183.52.150.87:61234
    # 221.10.159.234:1337
    # 110.73.32.25:8123
    # 183.52.150.156:61234
    # 219.138.58.247:3128
    # 183.52.150.179:61234
    # 27.40.137.19:61234
    # 110.73.5.224:8123
    # 110.72.29.86:8123
    # 49.72.4.176:61234
    # 110.73.41.128:8123
    # 110.73.29.53:8123
    # 110.73.42.147:8123
    # 183.144.200.165:3128
    # 110.73.50.39:8123
    # 180.123.27.176:45806
    # 59.58.202.237:20539
    # 125.79.71.89:45539
    # 49.85.6.87:26805
    # 183.52.150.97:61234
    # 60.214.155.243:53281
    # 27.40.158.33:61234
    # 111.231.23.32:8888
    # 182.112.203.41:8118
    # 123.206.132.156:8888
    # 123.206.132.106:8888
    # 111.231.22.148:8888
    # 123.206.188.28:8888
    # 111.231.19.54:8888
    # 111.231.22.57:8888
    # 123.206.198.205:8888
    # 118.254.154.50:3128
    # 123.161.153.101:32463
    # 121.31.151.68:8123
    # 175.8.28.27:8118
    # 219.138.58.187:3128
    # 115.215.49.154:33862
    # 120.35.201.66:38183
    # 171.37.170.92:8123
    # 42.176.133.180:42136
    # 171.39.31.180:8123
    # 49.72.4.203:37377
    # 140.237.114.223:47717
    # 119.29.18.239:8888
    # 1.195.9.13:22993
    # 115.203.206.247:23939
    # 223.241.78.39:8010
    # 39.88.41.99:8118
    # 120.33.247.212:33339
    # 49.70.64.225:37007
    # 116.62.217.206:80
    # 115.46.98.23:8123
    # 183.52.150.145:61234
    # 123.185.129.49:8118
    # 110.73.51.40:8123
    # 221.233.85.65:3128
    # 118.114.77.47:8080
    # 114.95.112.144:8118
    # 144.123.71.160:49690
    # 49.87.177.35:46386
    # 182.91.227.42:8118
    # 221.7.175.143:8123
    # 114.229.36.235:40733
    # 125.109.198.176:36437
    # 123.163.160.143:808
    # 115.193.58.95:8118
    # 221.7.175.176:8123
    # 59.56.46.87:808
    # 115.202.55.75:3128
    # 222.183.208.239:8118
    # 59.51.120.238:3128
    # 219.138.58.67:3128
    # 175.171.186.176:53281
    # 60.214.118.170:63000
    # 110.73.51.76:8123
    # 27.40.158.166:61234
    # 223.241.78.214:8010
    # 121.206.70.166:49632
    # 114.230.218.193:39939
    # 49.85.11.114:20560
    # 171.11.229.202:22319
    # 59.51.122.30:3128
    # 223.247.242.173:29364
    # 60.169.220.107:29481
    # 114.235.22.143:20422
    # 113.121.242.121:38709
    # 49.87.181.72:41724
    # 182.96.194.239:8118
    # 121.31.155.135:8123
    # 36.25.26.136:41425
    # 121.205.254.203:21985
    # 176.235.11.6:8080
    # 176.9.28.86:1080
    # 5.189.135.164:3128
    # 64.33.171.19:8080
    # 166.111.131.52:3128
    # 51.15.196.77:8888
    # 93.94.223.18:8080
    # 123.125.159.122:80
    # 50.205.154.101:3128
    # 118.114.77.47:8080
    # """
    ip_pools = ip_strs.split('\n')
    ip_pools.pop()
    ip_pools.remove(ip_pools[0])
    for v in ip_pools:
        ip_pool.append(v.strip())
    return ip_pool
    # for v in ip_pool:
    #     v.strip()
    #     print(v)
    # print(ip_pool)
def get_real_ip_pool():
    real_ips1 = """
    122.114.31.177:808
    61.135.217.7:80
    183.52.150.156:61234
    183.144.200.165:3128
    116.62.217.206:80
    118.114.77.47:8080
    176.235.11.6:8080
    176.9.28.86:1080
    166.111.131.52:3128
    64.33.171.19:8080
    123.125.159.122:80
    50.205.154.101:3128
    118.114.77.47:8080
    93.94.223.18:8080
    51.15.196.77:8888
    """
    real_ips2 = """
    122.114.31.177:808
    61.135.217.7:80
    116.62.217.206:80
    118.114.77.47:8080
    176.235.11.6:8080
    176.9.28.86:1080
    166.111.131.52:3128
    51.15.196.77:8888
    123.125.159.122:80
    64.33.171.19:8080
    118.114.77.47:8080
    50.205.154.101:3128"""
    real_ips3 = """
    122.114.31.177:808
    61.135.217.7:80
    121.31.151.68:8123
    116.62.217.206:80
    118.114.77.47:8080
    176.9.28.86:1080
    166.111.131.52:3128
    176.235.11.6:8080
    51.15.196.77:8888
    64.33.171.19:8080
    118.114.77.47:8080
    50.205.154.101:3128
    123.125.159.122:80"""
    ip1=get_ip_pools(real_ips1)
    ip2=get_ip_pools(real_ips2)
    ip_pool=list(set(ip1).intersection(set(ip2)))
    print(ip_pool)

def getProxy():
    iplist=['51.15.196.77:8888', '176.9.28.86:1080','5.189.135.164:3128',
            '176.235.11.6:8080','52.221.236.95:3128','192.157.192.223:3128',
            '139.59.125.112:443','166.111.131.52:3128','122.192.32.76:7280'
            '80.87.81.102:80','64.33.171.19:8080','46.228.6.149:8081',
            '93.94.223.18:8080','166.111.131.52:3128''37.187.116.199:80',
            '50.205.154.101:3128','118.114.77.47:8080','123.125.159.122:80',
            '']
    ip_strs = """
        121.31.100.11:8123
        122.114.31.177:808
        219.138.58.30:3128
        61.135.217.7:80
        183.52.150.215:61234
        123.128.197.192:8118
        110.72.255.170:8123
        183.52.150.152:61234
        110.73.43.240:8123
        183.52.150.87:61234
        221.10.159.234:1337
        110.73.32.25:8123
        183.52.150.156:61234
        219.138.58.247:3128
        183.52.150.179:61234
        27.40.137.19:61234
        110.73.5.224:8123
        110.72.29.86:8123
        49.72.4.176:61234
        110.73.41.128:8123
        110.73.29.53:8123
        110.73.42.147:8123
        183.144.200.165:3128
        110.73.50.39:8123
        180.123.27.176:45806
        59.58.202.237:20539
        125.79.71.89:45539
        49.85.6.87:26805
        183.52.150.97:61234
        60.214.155.243:53281
        27.40.158.33:61234
        111.231.23.32:8888
        182.112.203.41:8118
        123.206.132.156:8888
        123.206.132.106:8888
        111.231.22.148:8888
        123.206.188.28:8888
        111.231.19.54:8888
        111.231.22.57:8888
        123.206.198.205:8888
        118.254.154.50:3128
        123.161.153.101:32463
        121.31.151.68:8123
        175.8.28.27:8118
        219.138.58.187:3128
        115.215.49.154:33862
        120.35.201.66:38183
        171.37.170.92:8123
        42.176.133.180:42136
        171.39.31.180:8123
        49.72.4.203:37377
        140.237.114.223:47717
        119.29.18.239:8888
        1.195.9.13:22993
        115.203.206.247:23939
        223.241.78.39:8010
        39.88.41.99:8118
        120.33.247.212:33339
        49.70.64.225:37007
        116.62.217.206:80
        115.46.98.23:8123
        183.52.150.145:61234
        123.185.129.49:8118
        110.73.51.40:8123
        221.233.85.65:3128
        118.114.77.47:8080
        114.95.112.144:8118
        144.123.71.160:49690
        49.87.177.35:46386
        182.91.227.42:8118
        221.7.175.143:8123
        114.229.36.235:40733
        125.109.198.176:36437
        123.163.160.143:808
        115.193.58.95:8118
        221.7.175.176:8123
        59.56.46.87:808
        115.202.55.75:3128
        222.183.208.239:8118
        59.51.120.238:3128
        219.138.58.67:3128
        175.171.186.176:53281
        60.214.118.170:63000
        110.73.51.76:8123
        27.40.158.166:61234
        223.241.78.214:8010
        121.206.70.166:49632
        114.230.218.193:39939
        49.85.11.114:20560
        171.11.229.202:22319
        59.51.122.30:3128
        223.247.242.173:29364
        60.169.220.107:29481
        114.235.22.143:20422
        113.121.242.121:38709
        49.87.181.72:41724
        182.96.194.239:8118
        121.31.155.135:8123
        36.25.26.136:41425
        121.205.254.203:21985
        176.235.11.6:8080
        176.9.28.86:1080
        5.189.135.164:3128
        64.33.171.19:8080
        166.111.131.52:3128
        51.15.196.77:8888
        93.94.223.18:8080
        123.125.159.122:80
        50.205.154.101:3128
        118.114.77.47:8080
        """
    iplist=get_ip_pools(ip_strs)
    proxy = []
    for v in iplist:
        ip_dict = {'http': v}
        proxy.append(ip_dict)
    print(proxy)
    return proxy


def test_ip():
    ip = getProxy()
    for v in ip:
        try:
            response = requests.get('http://www.baidu.com', proxies=v, timeout=3)
            if response:
                print("success!  ", v)
        except:
            pass


def test(proxy):
    try:
        response = requests.get('http://www.baidu.com', proxies=proxy, timeout=3)
        if response:
            print(proxy['http'])
    except:
        pass


if __name__ == '__main__':
    # test_ip()
    proxy = getProxy()
    # IPPool1 = []
    # time1 = time.time()
    # for item in proxy:
    #     IPPool1.append(test(item))
    # time2 = time.time()
    # print('singleprocess needs ' + str(time2 - time1) + ' s')
    pool = Pool()
    IPPool2 = []
    temp = []
    time3 = time.time()
    for item in proxy:
        temp.append(pool.apply_async(test, args=(item,)))
    pool.close()
    pool.join()
    for item in temp:
        IPPool2.append(item.get())
    time4 = time.time()
    print('multiprocess needs ' + str(time4 - time3) + ' s')
    get_real_ip_pool()


    # '176.235.11.6:8080','176.9.28.86:1080','5.189.135.164:3128','64.33.171.19:8080','166.111.131.52:3128','51.15.196.77:8888','93.94.223.18:8080','123.125.159.122:80','50.205.154.101:3128','118.114.77.47:8080'
